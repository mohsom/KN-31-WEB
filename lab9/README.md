# Лабораторна робота 9 - Система аутентифікації

## Мета роботи

Реалізувати систему аутентифікації з реєстрацією та входом користувачів на веб-сторінку з використанням Express.js, сесій, bcrypt та EJS.

## Опис програми

Система аутентифікації з наступними можливостями:

- **Реєстрація користувачів:**
  - ПІБ (3-30 символів)
  - Email (унікальний)
  - Пароль (мінімум 6 символів)
  - Підтвердження пароля

- **Вхід користувачів:**
  - Email
  - Пароль

- **Захищені маршрути:**
  - Dashboard доступний тільки для авторизованих користувачів
  - Login/Register недоступні для авторизованих користувачів

- **Безпека:**
  - Паролі хешуються через bcrypt
  - Сесії для збереження стану авторизації
  - Валідація через express-validator

## Структура проєкту

```
lab9/
├── server.js              # Основний файл сервера
├── package.json           # Залежності та конфігурація
├── users.json             # JSON файл з користувачами
├── middleware/
│   ├── auth.js            # Middleware для перевірки авторизації
│   └── validator.js       # Валідація форм
├── utils/
│   └── db.js              # Функції для роботи з users.json
├── views/                 # EJS шаблони
│   ├── register.ejs       # Форма реєстрації
│   ├── login.ejs          # Форма входу
│   └── dashboard.ejs      # Панель управління
├── public/
│   └── style.css          # Стилі
└── README.md              # Документація
```

## Встановлення та запуск

### Вимоги

- Node.js (версія 12 або вище)
- npm

### Кроки встановлення

```bash
# Перейти в папку lab9
cd lab9

# Встановити залежності
npm install

# Запустити сервер
npm start
```

Після запуску сервер буде доступний за адресою: `http://localhost:3000`

## Маршрути

### GET /

Редірект на `/login` або `/dashboard` залежно від авторизації.

### GET /register

Форма реєстрації (тільки для неавторизованих).

### POST /register

Обробка реєстрації:
- Валідація даних
- Перевірка унікальності email
- Хешування пароля
- Збереження користувача
- Створення сесії
- Редірект на `/dashboard`

### GET /login

Форма входу (тільки для неавторизованих).

### POST /login

Обробка входу:
- Валідація email
- Пошук користувача
- Перевірка пароля через bcrypt
- Створення сесії
- Редірект на `/dashboard`

### GET /dashboard

Захищена сторінка з привітанням користувача (тільки для авторизованих).

### GET /logout

Вихід з системи:
- Знищення сесії
- Редірект на `/login`

## Валідація

### Реєстрація

- **ПІБ:** 3-30 символів, тільки літери та пробіли
- **Email:** валідний формат, унікальний
- **Пароль:** мінімум 6 символів
- **Підтвердження пароля:** має збігатися з паролем

### Вхід

- **Email:** валідний формат
- **Пароль:** обов'язковий
- Перевірка існування користувача
- Перевірка правильності пароля

## Middleware

### isAuthenticated

Перевіряє, чи користувач авторизований. Якщо ні - редірект на `/login`.

### isNotAuthenticated

Перевіряє, чи користувач не авторизований. Якщо авторизований - редірект на `/dashboard`.

## Flash повідомлення

Система використовує `connect-flash` для відображення повідомлень:

- **Успіх:** зелена алерта
- **Помилки:** червона алерта зі списком помилок
- **Збереження даних:** форми зберігають введені дані при помилках

## Безпека

- Паролі хешуються через bcrypt з salt rounds = 10
- Сесії зберігаються на сервері
- Валідація на стороні сервера
- Захист від CSRF через сесії
- Нормалізація email (нижній регістр)

## Особливості реалізації

- Використання EJS для шаблонів
- Flash messages для відображення помилок та успіхів
- Збереження введених даних при помилках валідації
- Автоматичний редірект залежно від стану авторизації
- Захищені маршрути через middleware

## Автор

Скальський Володимир

