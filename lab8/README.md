# Лабораторна робота 8 - Обробка HTML-форм з валідацією

## Мета роботи

- Ознайомитися з принципами обробки HTML-форм на стороні сервера (POST-запити, body-parser, express.urlencoded)
- Навчитися використовувати middleware для валідації вхідних даних (express-validator)
- Закріпити навички створення маршрутів для обробки форм
- Реалізувати просту валідацію та виведення помилок користувачу

## Опис програми

Трекер витрат з обробкою HTML-форм та валідацією даних:

- **Поля форми:**
  - `description` - опис витрати (обов'язкове, 3-100 символів)
  - `amount` - сума (обов'язкове, > 0)
  - `category` - категорія (обов'язкове, 2-50 символів)
  - `date` - дата (обов'язкове, ≤ сьогодні)

- **Валідація:**
  - Всі поля обов'язкові
  - Сума має бути більше 0
  - Дата не може бути пізніше сьогодні
  - Довжина полів відповідає вимогам

- **Функціонал:**
  - Додавання витрат через HTML-форму
  - Відображення історії витрат
  - Підрахунок загальної суми
  - Відображення помилок валідації поруч із полями

## Структура проєкту

```
lab8/
├── app.js                  # Основний файл сервера
├── package.json            # Залежності та конфігурація
├── data/
│   └── expenses.json      # JSON файл з даними
├── routes/
│   └── expenses.js        # Маршрути для обробки форм
├── utils/
│   ├── fileHandler.js     # Функції для роботи з файлами
│   └── validators.js       # Валідація даних
├── requests.log           # Лог запитів до сервера
├── README.md              # Документація
└── public/                # Статичні файли
    ├── index.html         # HTML-форма
    ├── style.css          # Стилі
    └── script.js          # JavaScript для роботи з формою
```

## Встановлення та запуск

### Вимоги

- Node.js (версія 12 або вище)
- npm

### Кроки встановлення

```bash
# Перейти в папку lab8
cd lab8

# Встановити залежності
npm install

# Запустити сервер
npm start
```

Після запуску сервер буде доступний за адресою: `http://localhost:3000`

## Валідація даних

### Правила валідації

1. **description** (Опис):
   - Обов'язкове поле
   - Мінімум 3 символи
   - Максимум 100 символів

2. **amount** (Сума):
   - Обов'язкове поле
   - Має бути числом
   - Має бути більше 0

3. **category** (Категорія):
   - Обов'язкове поле
   - Мінімум 2 символи
   - Максимум 50 символів

4. **date** (Дата):
   - Обов'язкове поле
   - Формат: YYYY-MM-DD
   - Не може бути пізніше сьогодні

### Обробка помилок

При помилках валідації:
- Повертається JSON з масивом помилок
- Помилки відображаються поруч із відповідними полями
- Поля з помилками підсвічуються червоним кольором

## API Документація

### GET /api/expenses

Отримати всі витрати.

**Відповідь:**
```json
[
  {
    "id": 1,
    "description": "Продукти в супермаркеті",
    "amount": 250.50,
    "category": "Продукти",
    "date": "2025-01-15",
    "createdAt": "2025-01-15T10:30:00.000Z"
  }
]
```

### POST /api/expenses

Додати нову витрату.

**Тіло запиту (application/x-www-form-urlencoded):**
```
description=Продукти в супермаркеті&amount=250.50&category=Продукти&date=2025-01-15
```

**Успішна відповідь:**
```json
{
  "success": true,
  "message": "Витрату додано успішно!",
  "expense": {
    "id": 1,
    "description": "Продукти в супермаркеті",
    "amount": 250.50,
    "category": "Продукти",
    "date": "2025-01-15",
    "createdAt": "2025-01-15T10:30:00.000Z"
  }
}
```

**Відповідь з помилками валідації:**
```json
{
  "success": false,
  "errors": [
    {
      "path": "amount",
      "msg": "Сума має бути більше 0"
    }
  ],
  "old": {
    "description": "Продукти",
    "amount": "-10",
    "category": "Продукти",
    "date": "2025-01-15"
  }
}
```

## Особливості реалізації

- Використання `express-validator` для валідації
- Middleware для логування всіх запитів у файл `requests.log`
- Обробка помилок через try-catch
- Відображення помилок валідації поруч із полями форми
- Автоматичне встановлення максимальної дати (сьогодні) у формі
- Підрахунок загальної суми витрат

## Автор

Скальський Володимир

